<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>湛德财务项目管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/sq.css">
    <style type="text/css">
        body{
            padding-bottom: 70px;
        }
        #mainContainer{
            overflow: hidden;;
        }
        #topContainer{
            text-align: center;
            background-color: #003c97;
            color: #FFF;
            font-weight: bold;
            font-size: 18px;
            padding: 20px;
        }
        .iconContent{
            float: left;
            text-align: center;
            font-size: 14px;
        }
        #myUL{
            margin: 0;
            padding: 20px;
            background-color: #FFF;
        }
        #myUL li{
            list-style: none;
            background-color: #FFFFFF;
            margin: 5px 0 0 1%;
            padding: 0 0 10px 0;
            border-radius: 5px;
            cursor: pointer;
            overflow: hidden;
            border-bottom: 1px solid #efefef;
        }
        #myUL li p{
            padding: 5px;
        }
        .lxdh{
            margin-left: 10px;
            color: #FD482C;
        }
        #footContainer{
            font-size: 10px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #efefef;
            text-align: center;
        }
        .sq-one-line{
            padding:10px;
            overflow: hidden;
            font-size: 14px;
            border-bottom: 1px solid #efefef;
        }
        .layui-col-xs2{

        }
    </style>
</head>
<body>
<div id="topContainer">
    项目详情
</div>

<div id="mainContainer" class="layui-form">
    <div style="padding: 10px;">
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="" id="span_1">项目名称：</span>
                <strong id="totalnum1" style="color: #003c97;" >新建时弹窗填写</strong>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="name" class="layui-btn layui-btn-sm" style="background-color: #003c97; display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs6">
                <span style="" id="apply_username">申请人：</span><strong id="user_nickname" style="color: #003c97;">13255</strong>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs6">
                <span style="" id="span_2">项目编号：</span><strong id="totalnum2" style="color: #003c97;">13255</strong>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs6">
                <span style="" id="span_4">税费：</span><strong id="totalnum4" style="color: #003c97;"></strong><span>元</span>
            </div>

        </div>

        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_5">拟成交价：</span><strong id="totalnum5" style="color: #003c97;">12654.12</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="protrans_price" class="layui-btn layui-btn-sm"  style="display: none;background-color: #003c97;" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_6">成交价(开票）：</span><strong id="totalnum6" style="color: #003c97;">125654.00</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="trans_price" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span  style="line-height: 30px;" id="span_7">汇款期限：</span><strong id="totalnum7" style="color: #003c97;">10</strong><span>天</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="remittance_term" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_8">差旅费：</span><strong id="totalnum8" style="color: #003c97;">10</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="travel" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span  style="line-height: 30px;" id="span_9">交际费：</span><strong id="totalnum9" style="color: #003c97;">10</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="communication" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_10">招标费：</span><strong id="totalnum10" style="color: #003c97;">10</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="tender" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_11">采购成本：</span><strong id="totalnum11" style="color: #003c97;">10</strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="purchasing_cost" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <!--        <div class="sq-one-line">-->
        <!--            <div class="layui-col-xs10">-->
        <!--                <span style="line-height: 30px;"><成本预算></成本预算>：<strong id="totalnum11" style="color: #003c97;">10</strong>天</span>-->
        <!--            </div>-->
        <!--            <div class="layui-col-xs2" style="text-align: right;">-->
        <!--                <button id="purchasing_cost" class="layui-btn layui-btn-sm" onclick="sq.open('')" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>-->
        <!--            </div>-->
        <!--        </div>-->
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_12">产品维修：</span><strong id="totalnum12" style="color: #003c97;"></strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="product_maintenance" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_13">经销商维修：</span><strong id="totalnum13" style="color: #003c97;"></strong><span>元</span>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="dealer_maintenance" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line" id="turn_ratio_div">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_14">上缴比例：</span><strong id="totalnum14" style="color: #003c97;">11</strong>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="turn_ratio" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line" id="department_promotion_div">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_15">部门上提比例：</span><strong id="totalnum15" style="color: #003c97;">10</strong>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="department_promotion" class="layui-btn layui-btn-sm"  style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line" id="proportion_promotion_div">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_16">行政上提比例：</span><strong id="totalnum16" style="color: #003c97;">10</strong>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="proportion_promotion" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line" id="tax_rate_div">
            <div class="layui-col-xs10">
                <span style="line-height: 30px;" id="span_17">税率：</span><strong id="totalnum17" style="color: #003c97;"></strong>
            </div>
            <div class="layui-col-xs2" style="text-align: right;">
                <button id="tax_rate" class="layui-btn layui-btn-sm" style="background-color: #003c97;display: none" type="button"><i class="layui-icon layui-icon-edit"></i></button>
            </div>
        </div>
        <div class="sq-one-line" style="text-align: right;" >
            <div class="sq-one-line">
                <div class="layui-col-xs9">
                    <span style="text-align: center" id="span_3">报价合计：</span> <strong id="totalnum3" style="color: #003c97;">13255.23</strong><span>元</span>
                </div>
            </div>
            <div class="layui-col-xs6" style="font-size: 16px;">
                <span style="line-height: 40px;" id="span_18">产品数：</span><strong id="quantity_1">0</strong>
            </div>
            <div class="layui-col-xs6" >
                <button id="add_goods" class="layui-btn layui-btn-normal" onclick="addGoods()" style="background-color: #FD482C;display: none" type="button">添加产品</button>
            </div>
        </div>

    </div>
    <div style= "width: 100%; overflow: scroll">
        <table class="layui-table" id="project_table"  style="width: 160%;">
            <colgroup>
                <col>
                <col>
                <col>
                <col>
                <col>
                <col>
            </colgroup>
            <thead>
            <tr>
                <th id="th_id" style="display: none">ID</th>
                <th id="product_name">产品名</th>
                <th id="model">规格</th>
                <th id="quantity">数量</th>
                <th id="price">报价</th>
            </tr>
            </thead>
            <tbody id="ttbody"></tbody>
        </table>
    </div>
    <hr class="layui-border-blue">
    <div class="layui-collapse" >
        <div class="layui-colla-item" >
            <h2 class="layui-colla-title">操作记录</h2>
            <div class="layui-colla-content" style="padding: 1px 1px">
                <div style= "width: 100%; overflow: scroll">
                    <table class="layui-table" id="log_table"  style="width: 160%;">
                        <colgroup>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th id="user_name">姓名</th>
                            <th id="column">字段</th>
                            <th id="old_value">原始值</th>
                            <th id="new_value">更新值</th>
                            <th id="edit_tima">修改时间</th>
                        </tr>
                        </thead>
                        <tbody id="ttbody_1"></tbody>
                    </table>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
<!--下方为模板部分-->
<!--用户登陆的模板-->
</body>
<script type="text/javascript" src="../js/jquery-3.3.1.min.js" language="JavaScript"></script>
<script src="../layui/layui.js"></script>

<script src="../js/ajax.js"></script>

<script>
    getAjaxDate('/api/option/','get',{item_id:sq.getHashStringArgs()['id']},function (rel) {
        console.log(rel.data)
        set_LogTable(rel.data.results)
    });
    layui.use('element', function(){
        var element = layui.element;
    });
    // 用户权限限制
    var role_id = window.sessionStorage.getItem("role_id");
    var id = sq.getHashStringArgs()["id"];

    var sendObj = new Object();
    sendObj.item = id;
    sendObj.type = "";
    sendObj.page_size = 1000;
    getList();
    //获取项目数据
    function getList(cur_page) {
        sendObj.page = cur_page;
        getAjaxDate("/api/item/"+id+"/","get",
            sendObj,
            function(rel){
                show_content(rel)
            }
        );
    }
    show_prolist()
    // 显示表中信息
    function show_content(rel) {
        $("#totalnum1").text(rel.data.name)
        $("#user_nickname").text(rel.data.nickname)
        $("#totalnum2").text(rel.data.number)
        $("#totalnum5").text(rel.data.protrans_price)
        $("#totalnum6").text(rel.data.trans_price)
        $("#totalnum7").text(rel.data.remittance_term)
        $("#totalnum8").text(rel.data.travel)
        $("#totalnum9").text(rel.data.communication)
        $("#totalnum10").text(rel.data.tender)
        $("#totalnum12").text(rel.data.product_maintenance)
        $("#totalnum13").text(rel.data.dealer_maintenance)
        $("#totalnum14").text(rel.data.department_promotion)
        $("#totalnum15").text(rel.data.proportion_promotion)
        $("#totalnum16").text(rel.data.tax_rate)
    }

    // 获取商品列表
    function show_prolist() {
        getAjaxDate("/api/itemProduct/","get",
            sendObj,
            function(rel) {
                $("#ttbody").empty()
                $("#quantity_1").text(rel.data.total_items)
                setTable(rel.data.results)
                let total_price = 0;
                for (let i = 0;i <rel.data.results.length;++i){
                    total_price +=  parseFloat(rel.data.results[i].price)
                }
                $("#totalnum3").text(total_price)
                $("#totalnum11").text(total_price*0.56)
                let tax = 1.13
                $("#totalnum4").text((($("#totalnum6").text()-$("#totalnum11").text()-$("#totalnum12").text()-$("#totalnum13").text())/tax*0.13*1.12+$("#totalnum6").text()/tax*0.00012).toFixed(2))
            }
        );
    }
    // 渲染商品列表
    function setTable(infoList) {
        infoList.forEach(function (value) {
            $("#project_table").append(
                '<tr>' +
                '<td style="display:none;">'+value.id+'</td>' +
                '<td>'+value.name+'</td>' +
                '<td>'+value.model+'</td>' +
                '<td>'+value.quantity+'</td>'+
                '<td>'+value.price+'</td>'+
                // '</tr>'+'<tr>'+'<td></td>'+'<td></td>'+'<td></td>'+
                '</tr>'
            )
        })
    }
    function set_LogTable(infoList) {
        infoList.forEach(function (value) {
            $("#log_table").append(
                '<tr>' +
                '<td>'+value.user_name+'</td>' +
                '<td>'+value.column+'</td>' +
                '<td>'+value.old_value+'</td>' +
                '<td>'+value.new_value+'</td>'+
                '<td>'+value.time+'</td>'+
                '</tr>'
            )
        })
    }

</script>
</html>
