<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>湛德财务项目管理系统</title>
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/skin.css">
    <link rel="stylesheet" href="../../css/sq.css">
    <style type="text/css">
        .layui-form-select dl{
            max-height: 120px;
        }
        body{
            background-color: #efefef;
        }
        .table_title{
            font-weight: bold;
            font-size: 16px;
        }
        .table_above td{
            border: 0;
        }
        .table_above{
            margin: 0 auto;
        }
        .certer{
            text-align: center;
        }
    </style>
</head>
<body>
<div style="padding: 10px;border: 1px solid #eee;">
    <div style="padding: 20px;margin: 15px;background-color: #FFFFFF">
        <table class="layui-table table_above" style="margin-left:80px;">
            <tr>
                <td style="width: 90px;"><strong class="table_title">项目名</strong></td>
                <td><span type="text"  id="pro_name"  style="" readonly></span></td>
                <td style="width: 80px;"><strong class="table_title">项目编号</strong></td>
                <td><span type="text"  id="pro_number"  style="" readonly></span></td>
            </tr>
            <tr>
                <td><strong class="table_title">部门名称</strong></td>
                <td><span type="text" id="department_name"  style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td><strong class="table_title">申请人</strong></td>
                <td><span type="text"  id="nickname"  style="width: 100px;margin-bottom: 5px" readonly></span></td>
            </tr>
            <tr>
                <td><strong class="table_title">拟成交价</strong></td>
                <td><span type="text"  id="protrans_price"  style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td><strong class="table_title">成交价</strong></td>
                <td><span type="text" id="trans_price"  style="width: 100px;margin-bottom: 5px" readonly></span></td>
            </tr>
            <tr>
                <td><strong class="table_title">预计结余</strong></td>
                <td> <span type="text"  id="pro_surplus"  style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td><strong class="table_title">实际结余</strong></td>
                <td><span type="text"  id="surplus"  style="width: 100px;margin-bottom: 5px" readonly></span></td>
            </tr>
            <tr>
                <td><strong class="table_title">预计支出</strong></td>
                <td><span type="text"  id="pro_cost" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td><strong class="table_title">实际支出</strong></td>
                <td><span type="text"  id="cost"  style="width: 100px;margin-bottom: 5px" readonly></span></td>
            </tr>
        </table>
    </div>
    <hr>
    <div style="padding: 20px;margin: 15px;background-color: #FFFFFF">
        <table class="layui-table">
            <tr>
                <thead>
                <td class="certer"><strong class="table_title">条目</strong></td>
                <td class="certer"><strong class="table_title">额度</strong></td>
                <td class="certer"><strong class="table_title">已使用</strong></td>
                <td class="certer"><strong class="table_title">剩余</strong></td>
                <td class="certer"><strong class="table_title">最新使用时间</strong></td>
                <td style="width: 85px;"><strong class="table_title">明细及管理</strong></td>
                </thead>
            </tr>
            <tr>
                <td class="certer"><strong>差旅费</strong></td>
                <td class="certer"><span type="text"  id="travel" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_travel" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_travel_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_travel_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm" onclick="show_log('travel')" style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>
            </tr>
            <tr>
                <td class="certer"><strong>交际费</strong></td>
                <td class="certer"><span type="text"  id="communication" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_communication" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_communication_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_communication_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm" onclick="show_log('communication')"  style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>
            </tr>
            <tr>
                <td class="certer"><strong>市场投入</strong></td>
                <td class="certer"><span type="text"  id="market_investment" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_market_investment" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_market_investment_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_market_investment_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm"  onclick="show_log('market_investment')" style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>
            </tr>
            <tr>
                <td class="certer"><strong>招标费</strong></td>
                <td class="certer"><span type="text"  id="tender" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_tender" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_tender_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_tender_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm" onclick="show_log('tender')"  style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>

            </tr>
            <tr>
                <thead>
                <td class="certer"><strong>费用合计</strong></td>
                <td class="certer"><span type="text"  id="sum" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="maintenance_sum" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="remain_sum" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"></td>
                <td class="certer"></td>
                </thead>
            </tr>
            <tr>
                <td class="certer"><strong>采购成本</strong></td>
                <td class="certer"><span type="text"  id="purchasing_cost" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_purchasing_cost" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_purchasing_cost_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_purchasing_cost_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm" onclick="show_log('purchasing_cost')"  style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>

            </tr>
            <tr>
                <td class="certer"><strong>经销商维修费</strong></td>
                <td class="certer"><span type="text"  id="dealer_maintenance" placeholder="请输入内容" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_dealer_maintenance" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_dealer_maintenance_remain" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_dealer_maintenance_time" placeholder="请输入内容" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm"  onclick="show_log('dealer_maintenance')" style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>

            </tr>
            <tr>
                <td class="certer"><strong>产品维修</strong></td>
                <td class="certer"><span type="text"  id="product_maintenance" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_product_maintenance" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_product_maintenance_remain" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="real_product_maintenance_time"  style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><button class="layui-btn layui-btn-normal layui-btn-sm" onclick="show_log('product_maintenance')"  style="background-color: #2D93CA;padding: 0px 10px;" type="button"><i class="layui-icon layui-icon-form"></i></button></td>
            </tr>
            <tr>
                <thead>
                <td class="certer"><strong>成本合计</strong></td>
                <td class="certer"><span type="text"  id="cost_sum" style="text-align: left;width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="cost_maintenance_sum" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"><span type="text"  id="cost_remain_sum" style="width: 100px;margin-bottom: 5px" readonly></span></td>
                <td class="certer"></td>
                <td class="certer"></td>
                </thead>
            </tr>
        </table>
    </div>
</div>
<!--<div class="layui-col-md5">-->
<!--    <iframe id="iframe_id" frameborder="0" src="product_costdetail.html" width="100%" height="800"></iframe>-->
<!--</div>-->
<!--<div class="layui-col-md7">-->
<!--    <iframe frameborder="0" src="cost_input.html#data=" width="100%" height="800"></iframe>-->
<!--</div>-->
<script src="../../js/jquery.min.js"></script>
<script src="../../layui/layui.js"></script>
<script src="../../js/ajax.js"></script>
<script type="text/javascript">
    var obj = JSON.parse(decodeURIComponent(sq.getHashStringArgs()["data"]));
    console.log(obj);
    function jump_previous() {
        // console.log(parent)
        parent.search_pro(parent.cur_page,'reset');
        parent.layer.closeAll();
    }
    getList();
    function getList(){
        getAjaxDate('/api/item/'+obj.id+'/','get','',function (rel) {
            console.log(rel.data)
            setform(rel.data)
        })
    }
    function setform(data) {
        $("#pro_name").text(data.name);
        $("#pro_number").text(data.number);
        $("#department_name").text(data.department_name);
        $("#nickname").text(data.nickname);

        $("#protrans_price").text(numFormat(data.protrans_price));
        $("#trans_price").text(numFormat(data.protrans_price));
        $("#pro_surplus").text(numFormat(data.pro_surplus));
        $("#surplus").text(numFormat(data.surplus));
        $("#pro_cost").text(numFormat(data.pro_cost));
        $("#cost").text(numFormat(data.cost));
        // 各项费用
        $("#travel").text(numFormat(data.travel));
        $("#real_travel").text(numFormat(data.real_travel));
        $("#communication").text(numFormat(data.communication));
        $("#real_communication").text(numFormat(data.real_communication));
        $("#market_investment").text(numFormat(data.market_investment));
        $("#real_market_investment").text(numFormat(data.real_market_investment));
        $("#tender").text(numFormat(data.tender));
        $("#real_tender").text(numFormat(data.real_tender));
        $("#purchasing_cost").text(numFormat(data.purchasing_cost));
        $("#real_purchasing_cost").text(numFormat(data.real_purchasing_cost));
        $("#dealer_maintenance").text(numFormat(data.dealer_maintenance));
        $("#real_dealer_maintenance").text(numFormat(data.real_dealer_maintenance));
        $("#product_maintenance").text(numFormat(data.product_maintenance));
        $("#real_product_maintenance").text(numFormat(data.real_product_maintenance));
        //剩余可用费用
        $("#real_travel_remain").text(numFormat(parseFloat(data.travel)-parseFloat(data.real_travel)));
        $("#real_communication_remain").text(numFormat(parseFloat(data.communication) - parseFloat(data.real_communication)));
        $("#real_market_investment_remain").text(numFormat(parseFloat(data.market_investment) - parseFloat(data.real_market_investment)));
        $("#real_tender_remain").text(numFormat(parseFloat(data.tender) - parseFloat(data.real_tender)));
        $("#real_purchasing_cost_remain").text(numFormat(parseFloat(data.purchasing_cost) - parseFloat(data.real_purchasing_cost)));
        $("#real_dealer_maintenance_remain").text(numFormat(parseFloat(data.dealer_maintenance) - parseFloat(data.real_dealer_maintenance)));
        $("#real_product_maintenance_remain").text(numFormat(parseFloat(data.product_maintenance) - parseFloat(data.real_product_maintenance)));
        //显示时间
        $("#real_travel_time").text(data.travel_time);
        $("#real_communication_time").text(data.communication_time);
        $("#real_market_investment_time").text(data.market_investment_time);
        $("#real_tender_time").text(data.tender_time);
        $("#real_purchasing_cost_time").text(data.purchasing_cost_time);
        $("#real_dealer_maintenance_time").text(data.dealer_maintenance_time);
        $("#real_product_maintenance_time").text(data.product_maintenance_time);




        let cost_sumdata = parseFloat(data.purchasing_cost) + parseFloat(data.product_maintenance) + parseFloat(data.dealer_maintenance)
        let cost_maintenancedata = parseFloat(data.real_purchasing_cost) + parseFloat(data.real_product_maintenance) + parseFloat(data.real_dealer_maintenance)

        $("#cost_sum").text(numFormat(cost_sumdata));
        $("#cost_maintenance_sum").text(numFormat(cost_maintenancedata));
        $("#cost_remain_sum").text(numFormat(cost_sumdata-cost_maintenancedata));

        let sumdata = parseFloat(data.travel) +
            parseFloat(data.communication) +
            parseFloat(data.market_investment)+
            parseFloat(data.tender)
        let maintenancedata = parseFloat(data.real_travel) +
            parseFloat(data.real_communication) +
            parseFloat(data.real_market_investment)+
            parseFloat(data.real_tender)

        $("#sum").text(numFormat(sumdata));
        $("#maintenance_sum").text(numFormat(maintenancedata));
        $("#remain_sum").text(numFormat(sumdata-maintenancedata));
    }
    function show_log(type) {
        if(tooFastCall( window.location.href,arguments.callee.name))return;//防止快速点击
        let tgt = Math.random();//随机
        top.frameset[tgt]=self.frameElement;
        top.layer.open({
            type: 2,
            shadeClose: true,
            shade: 0.7,
            maxmin: true, //开启最大化最小化按钮
            area: ['1000px', '600px'],
            content: 'pages/Project_Execute/show_log.html#tgt='+tgt+"&type="+type,
        });
    }
</script>
</body>
</html>
